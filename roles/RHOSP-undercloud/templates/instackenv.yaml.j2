nodes:
{% for vm in vms if not vm.profile == 'undercloud' %}
{% if RHOSP_version == 13.0 %}
  - mac: 
      - '{{ vm.mac }}:{{ (networks | selectattr('name', 'search', 'RHOSPVirtLab_ctlplane') | list | first).mac_suffix }}'
{% else %}
  - ports:
      - address: '{{ vm.mac }}:{{ (networks | selectattr('name', 'search', 'RHOSPVirtLab_ctlplane') | list | first).mac_suffix }}'
        physical_network: ctlplane
{% endif %}
    name: "{{ vm.name }}"
    capabilities: "node:{{ vm.name }},boot_option:local,boot_mode:uefi"
    cpu: {{ vm.vcpus }}
    memory: {{ (vm.memory / 1024) | int }}
    disk: {{ (vm.disk_size / 1073741824) | int }}
    arch: "x86_64"
    pm_type: "ipmi"
    pm_user: "admin"
    pm_password: "admin"
    pm_addr: "192.168.250.1"
    pm_port: "{{ vm.bmcport }}"
{% endfor %}

{% for node in physical %}
{% if RHOSP_version == 13.0 %}
  - mac: 
      - '{{ node.mac }}'
{% else %}
  - ports:
      - address: '{{ node.mac }}'
        physical_network: ctlplane
{% endif %}
    name: "{{ node.name }}"
    capabilities: "{{ ["node:" ~ node.name, "boot_option:local", node.capabilities] | join(',') }}"
    cpu: {{ node.cpus }}
    memory: {{ (node.memory / 1024) | int }}
    disk: {{ (node.disk_size / 1073741824) | int }}
    arch: "x86_64"
    pm_type: "{{ node.pm_type }}"
    pm_user: "{{ node.pm_user }}"
    pm_password: "{{ node.pm_password }}"
    pm_addr: "{{ node.pm_addr }}"
    pm_port: "{{ node.pm_port }}"
{% endfor %}
